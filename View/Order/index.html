<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <link rel="stylesheet" href="index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
      integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <title>Document</title>
  </head>
  <body>
    <!-- Nav -->
    <nav class="navbar navbar-expand-md fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="../../index.html">
          <div class="logo">5CT</div>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon">
            <i class="fas fa-bars" style="color: #cfcece; font-size: 28px"></i>
          </span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto d-flex w-100">
            <li class="nav-item">
              <a class="nav-link" href="#">PHIM</a>
            </li>
            <li class="nav-item">
              <a class="nav-link nav-current" href="#">LỊCH CHIẾU</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">ƯU ĐÃI</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">THÔNG TIN</a>
            </li>
            <li class="nav-item" id="login-accout">
              <a class="nav-link" href="#">Đăng nhập</a>
            </li>
            <li class="nav-item" id="create-accout">
              <a class="nav-link" href="#">Đăng ký</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="Main_Container">
      <div class="Choosing_day_Container">
        <img src="../../images/ArrowChangingDayBefore.png" alt="" id="prev-day"/>
        <div class="date-Container"></div>
        <img src="../../images/ChangingTheDayAfterArrow.png" alt="" id="next-day"/>
      </div>
      
      <div class="divider-container"></div>
      <div class="genre-select container-fluid">
        <div class="row g-2 genre-container"></div>
      </div>

      <div class="card-film-item-container container-fluid">
      </div>
      </div>
    </div>
    <!-- Footer -->
    <div class="footer">
      <div class="container-fluid">
        <div class="row d-flex">
          <div class="col-lg-3 col-md-5 col-sm-12" id="footer-first">
            <div class="footer-logo" style="margin-top: 0">
              <a href="#"> <p class="logo" style="font-size: 60px">5CT</p> </a>
              <p style="font-size: 12px; clear: left">
                COPYRIGHT © 5CODERCUTE.COM
                <br />
                ALL RIGHTS RESERVED.
              </p>
            </div>
          </div>
          <div class="col-lg-3 col-md-5 col-sm-12">
            <ul style="margin-top: 20px">
              <li>
                <a href="#" style="color: white; font-size: 18px">
                  Về chúng tôi
                </a>
              </li>
              <li><a href="#"> Liên hệ </a></li>
              <li><a href="#"> Tuyển dụng </a></li>
              <li><a href="#"> Blog </a></li>
              <li><a href="#"> FAQ </a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-5 col-sm-12">
            <ul style="margin-top: 20px">
              <li>
                <a href="#" style="color: white; font-size: 18px">
                  Điều khoản sử dụng
                </a>
              </li>
              <li><a href="#"> Điều khoản chung </a></li>
              <li><a href="#"> Điều khoản giao dịch </a></li>
              <li><a href="#"> Điều khoản thanh toán </a></li>
              <li><a href="#"> Chính sách bảo mật </a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-5 col-sm-12">
            <div style="margin-top: 20px">
              <div>
                <a href="#" class="btn-footer">
                  <img src="/images/email-multiple-outline.png" />
                  hoidap@5ct.vn
                </a>
              </div>
              <div>
                <a href="#" class="btn-footer">
                  <img src="/images/phone.png" /> 1900 1008
                </a>
              </div>
              <div class="footer-icon">
                <a href="#"> <img src="/images/facebook.png" /> </a>
                <a href="#"> <img src="/images/twitter.png" /> </a>
                <a href="#"> <img src="/images/google-plus.png" /> </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      import { getAllGenre } from "../API/GenreAPI.js";
      import {getShowTimeByID,getAllShowTimesByDate,getShowTimeByDateAndGenre} from "../API/ShowTimeAPI.js"
      import {getMovieByID} from "../API/MovieAPI.js"
      import {getRoomById } from "../API/RoomAPI.js"
      $(document).ready(function () {
        const date=new Date()

        $(".navbar-toggler").click(function () {
          var color = $(".navbar").css("background-color");
          if (color == "rgba(0, 0, 0, 0.01)") {
            $(".navbar").css("background", "rgba(0, 0, 0, 0.85)");
          } else {
            $(".navbar").css("background", "rgba(0, 0, 0, 0.01)");
          }
        });
        
        const TakingMovieByID=async(ID)=>{
          let data=await getMovieByID("../../.",ID);
          return data;
        }
        const TakingRoomByID=async(ID)=>{
          let data=await getRoomById("../../.",ID);
          return data;
        }
        const TakingShowTime=async()=>{
          await $(".card-film-item-container").html("")
          const IdMovieContainerCheck=[]
          const IdRoomContainerCheck=[]
          const datetoFetch=sessionStorage.getItem("DayChoosing")
          getAllShowTimesByDate("../../.","2022-10-10").then(async(datas)=>{
            const cuttingGenre = (data) => {
              let storehtml = "";
              data["ListGenre"].flat().forEach((element) => {
                storehtml += `<span>${element.GenreName}</span>`;
              });
              return storehtml;
            };
            datas["list"].forEach(async (data)=>{
            if(!IdMovieContainerCheck.includes(data.MovieID)){
              IdMovieContainerCheck.push(data.MovieID);
              IdRoomContainerCheck.push(data.RoomID)
              let dataMovie= await TakingMovieByID(data.MovieID);
              let RoomData=await TakingRoomByID(data.RoomID)
              dataMovie=dataMovie["movie"];
              RoomData=RoomData["room"]
              const datatoCut=data.StartTime;
              const GenreList= await cuttingGenre(dataMovie)
              const takingTime=await datatoCut.split(" ")[1]
              const renderTime=await takingTime.split(":")
              const htmls=`
              
             <div class="row card-film-cotainer">
               <div class="col-lg-3 item-img-container col-md-12 col-sm-12">
                 <img
                   src="../../images/poster.jpg"
                   alt=""
                   style="border-radius: 10px"
                 />
               </div>
               <div class="col-lg-8 item-info col-md-12 col-sm-12">
                 <div class="info-container-about-film">
                   <div class="heading-info-container">
                     <h2 class="heading-text">${dataMovie.MovieName}</h2>
                     <div class="rating">
                       <div class="rating-star">
                         <img src="../../images/Star.svg" alt="" />
                         ${dataMovie.rating}
                       </div>
                       <div class="rating-imdb">IMDB 7.2</div>
                     </div>
                   </div>
                   <p class="genre-text">${GenreList}</p>
                   <p class="type-text">2D | Phụ đề</p>
                </div>
                <div class="time-choosing-container container-fluid">
                  <div class="item-container row"></div>
                  </div>
                `
              await $(".card-film-item-container").append(htmls)
                let timehtmls=""
                timehtmls+=`
                <div class="item-choosing-time col-lg-2 col-md-5 col-sm-6">
                  <p class="place-to-choose">${RoomData.RoomName}</p>
                  <p class="time-to-choose">${renderTime[0]}:${renderTime[1]}</p>
                  <p class="seat-info"><b>${RoomData.NumberOfSeats}</b>/100 chỗ ngồi</p>
                </div>
                `
              await $(".item-container.row").append(timehtmls)
              }
            else{
              let dataMovie= await TakingMovieByID(data.MovieID);
              let RoomData=await TakingRoomByID(data.RoomID)
              dataMovie=dataMovie["movie"];
              RoomData=RoomData["room"]
              const datatoCut=data.StartTime;
              const GenreList= await cuttingGenre(dataMovie)
              const takingTime=await datatoCut.split(" ")[1]

              const renderTime=await takingTime.split(":")
                let timehtmls=""
                timehtmls+=await `
                <div class="item-choosing-time col-lg-2 col-md-5 col-sm-6">
                  <p class="place-to-choose">${RoomData.RoomName}</p>
                  <p class="time-to-choose">${renderTime[0]}:${renderTime[1]}</p>
                  <p class="seat-info"><b>${RoomData.NumberOfSeats}</b>/100 chỗ ngồi</p>
                </div>
                `
                let count=0;
              while(count<100){
                count++;
                if($(".item-container.row").length){
                  $(".item-container.row").append(timehtmls);
                  break; 
                }
              }
              
            
            }
            })
           
          })
        }
        function ChangingDate(){
        const daysOfWeek = ['Chủ nhật', 'Thứ hai', 'Thứ ba', 'Thứ tư', 'Thứ năm', 'Thứ sáu', 'Thứ bảy'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        // Get the date container and arrow buttons
        const previousDateBtn = document.getElementById('prev-day');
        const nextDateBtn = document.getElementById('next-day');
        const AddingDay=(date)=>{
          const dayOfMonth = date.getDate();
          const month = date.getMonth();
          const year = date.getFullYear();
          sessionStorage.setItem("DayChoosing",`${year}-${month}-${dayOfMonth}`)
          TakingShowTime();
        }
        // Initialize the current date to the first day in the HTML code
        let currentDate = new Date('April 22, 2023');
        // Initialize the date container with the first five days
        

        // Update the date container with the current date
            function updateDateContainer() {
              $(".date-Container").html("")
              AddingDay(currentDate);
              let dateHtml = '';
              for (let i = 0; i < 5; i++) {
                const dayOfWeek = daysOfWeek[currentDate.getDay()];
                const dayOfMonth = currentDate.getDate();
                const month = months[currentDate.getMonth()];
                
                const isActive = (i === 0) ? 'active' : '';
                dateHtml += `
                  <div class="item-day-holder ${isActive}">
                    <div class="day-text ${isActive}">${dayOfWeek}</div>
                    <div class="day-number ${isActive}">${dayOfMonth}</div>
                    <div class="month-text ${isActive}">${month}</div>
                  </div>
                `;
                currentDate.setDate(currentDate.getDate() + 1);
              }
              $(".date-Container").append(dateHtml);
              currentDate.setDate(currentDate.getDate() - 5); // Reset the current date
            }
            updateDateContainer();
            // Add click event listeners to the arrow buttons
            previousDateBtn.addEventListener('click', () => {
              currentDate.setDate(currentDate.getDate() - 1);
              updateDateContainer();
            });

            nextDateBtn.addEventListener('click', () => {
              currentDate.setDate(currentDate.getDate() + 1);
              updateDateContainer();
            });
          }
      ChangingDate();
        function changingBtnOnClickGetAll(GenreID) {
          const GenreContainer = $(".row.g-2.genre-container");
          const removeBtnColor = GenreContainer.find("button.btn-main");
          removeBtnColor.removeClass("btn-main");
          const AddingBtnColor = GenreContainer.find(`#${GenreID}`);
          AddingBtnColor.addClass("btn-main");
          TakingShowTime();
        }
        function changingBtnOnClick(GenreID) {
          const GenreContainer = $(".row.g-2.genre-container");
          const removeBtnColor = GenreContainer.find("button.btn-main");
          removeBtnColor.removeClass("btn-main");
          const AddingBtnColor = GenreContainer.find(`#${GenreID}`);
          AddingBtnColor.addClass("btn-main");
          const IdMovieContainerCheck=[]
          const IdRoomContainerCheck=[]
          const datetoFetch=sessionStorage.getItem("DayChoosing")
          // UpWorking
          getShowTimeByDateAndGenre("../../.","2022-10-10",GenreID).then(async(datas)=>{
            await $(".card-film-item-container").html("")
            const cuttingGenre = (data) => {
              let storehtml = "";
              data["ListGenre"].flat().forEach((element) => {
                storehtml += `<span>${element.GenreName}</span>`;
              });
              return storehtml;
            };
            datas["list"].forEach(async (data)=>{
            if(!IdMovieContainerCheck.includes(data.MovieID)){
              IdMovieContainerCheck.push(data.MovieID);
              IdRoomContainerCheck.push(data.RoomID)
              let dataMovie= await TakingMovieByID(data.MovieID);
              let RoomData=await TakingRoomByID(data.RoomID)
              dataMovie=dataMovie["movie"];
              RoomData=RoomData["room"]
              const datatoCut=data.StartTime;
              const GenreList= await cuttingGenre(dataMovie)
              const takingTime=await datatoCut.split(" ")[1]
              const renderTime=await takingTime.split(":")
              const htmls=`
              
             <div class="row card-film-cotainer">
               <div class="col-lg-3 item-img-container col-md-12 col-sm-12">
                 <img
                   src="../../images/poster.jpg"
                   alt=""
                   style="border-radius: 10px"
                 />
               </div>
               <div class="col-lg-8 item-info col-md-12 col-sm-12">
                 <div class="info-container-about-film">
                   <div class="heading-info-container">
                     <h2 class="heading-text">${dataMovie.MovieName}</h2>
                     <div class="rating">
                       <div class="rating-star">
                         <img src="../../images/Star.svg" alt="" />
                         ${dataMovie.rating}
                       </div>
                       <div class="rating-imdb">IMDB 7.2</div>
                     </div>
                   </div>
                   <p class="genre-text">${GenreList}</p>
                   <p class="type-text">2D | Phụ đề</p>
                </div>
                <div class="time-choosing-container container-fluid">
                  <div class="item-container row"></div>
                  </div>
                `
              await $(".card-film-item-container").append(htmls)
                let timehtmls=""
                timehtmls+=`
                <div class="item-choosing-time col-lg-2 col-md-5 col-sm-6">
                  <p class="place-to-choose">${RoomData.RoomName}</p>
                  <p class="time-to-choose">${renderTime[0]}:${renderTime[1]}</p>
                  <p class="seat-info"><b>${RoomData.NumberOfSeats}</b>/100 chỗ ngồi</p>
                </div>
                `
              await $(".item-container.row").append(timehtmls)
              }
            else{
              let dataMovie= await TakingMovieByID(data.MovieID);
              let RoomData=await TakingRoomByID(data.RoomID)
              dataMovie=dataMovie["movie"];
              RoomData=RoomData["room"]
              const datatoCut=data.StartTime;
              const GenreList= await cuttingGenre(dataMovie)
              const takingTime=await datatoCut.split(" ")[1]

              const renderTime=await takingTime.split(":")
                let timehtmls=""
                timehtmls+=await `
                <div class="item-choosing-time col-lg-2 col-md-5 col-sm-6">
                  <p class="place-to-choose">${RoomData.RoomName}</p>
                  <p class="time-to-choose">${renderTime[0]}:${renderTime[1]}</p>
                  <p class="seat-info"><b>${RoomData.NumberOfSeats}</b>/100 chỗ ngồi</p>
                </div>
                `
                let count=0;
              while(count<100){
                count++;
                if($(".item-container.row").length){
                  $(".item-container.row").append(timehtmls);
                  break; 
                }
              }
              
            
            }
            })
           
          })
            };
            
          

        const takeAllGenre = async () => {
          const genreContainer = $(".row.g-2.genre-container");
          const button = $("<button>")
            .attr("id", "MBTN00001")
            .addClass("btn-main all-select")
            .text("Tất cả Phim");
          button.on("click", () => changingBtnOnClickGetAll("MBTN00001"));
          genreContainer.append(button);
          const setPageNum = async () => {
            const datas = await getAllGenre("../../.", 1);
            return datas["pagination"]["num_pages"];
          };

          const updatePageNum = async () => {
            const newPageNum = await setPageNum();
            pagenum = newPageNum;
            return pagenum;
          };

          var pagenum = await updatePageNum();
          for (let page = 1; page <= pagenum; page++) {
            getAllGenre("../../.", page).then((datas) => {
              const datastorender = datas["genres"];
              datastorender.forEach((data) => {
                const button = $("<button>")
                  .addClass("genre-btn-click")
                  .attr("id", data.GenreID)
                  .text(data.GenreName);
                button.on("click", () => changingBtnOnClick(data.GenreID));
                genreContainer.append(button);
              });
            });
          }
        };
        takeAllGenre();
        const getShowTimeByIDFunc = async ()=>{
          const datas=await getShowTimeByID("../..","M002","10");
        }
        getShowTimeByIDFunc();
      });
      // Modal trailer
    </script>
  <!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
